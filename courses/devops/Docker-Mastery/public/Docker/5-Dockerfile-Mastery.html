<!DOCTYPE html>
<html lang="en" dir="ltr"><head><title>5. Dockerfile Mastery</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;family=IBM Plex Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Quartz 4"/><meta property="og:title" content="5. Dockerfile Mastery"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="5. Dockerfile Mastery"/><meta name="twitter:description" content="A Dockerfile is not a shell script; it’s a deterministic build recipe that produces an immutable image."/><meta property="og:description" content="A Dockerfile is not a shell script; it’s a deterministic build recipe that produces an immutable image."/><meta property="og:image:alt" content="A Dockerfile is not a shell script; it’s a deterministic build recipe that produces an immutable image."/><meta property="twitter:domain" content="mahesh-puri.github.io/full-stack-dev"/><meta property="og:url" content="https://mahesh-puri.github.io/full-stack-dev/Docker/5-Dockerfile-Mastery"/><meta property="twitter:url" content="https://mahesh-puri.github.io/full-stack-dev/Docker/5-Dockerfile-Mastery"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="A Dockerfile is not a shell script; it’s a deterministic build recipe that produces an immutable image."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" data-persist="true"/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiRTpcXEdpdEh1YlxcZnVsbC1zdGFjay1kZXZcXGNvdXJzZXNcXGRldm9wc1xcRG9ja2VyLU1hc3RlcnlcXHF1YXJ0elxcY29tcG9uZW50c1xcc3R5bGVzIiwic291cmNlcyI6WyJtZXJtYWlkLmlubGluZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFHRjtFQUNFOzs7QUFLRjtFQUNFO0VBQ0E7OztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFJSjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTs7QUFJRjtFQUNFO0VBQ0E7RUFDQSIsInNvdXJjZXNDb250ZW50IjpbIi5leHBhbmQtYnV0dG9uIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBmbG9hdDogcmlnaHQ7XG4gIHBhZGRpbmc6IDAuNHJlbTtcbiAgbWFyZ2luOiAwLjNyZW07XG4gIHJpZ2h0OiAwOyAvLyBOT1RFOiByaWdodCB3aWxsIGJlIHNldCBpbiBtZXJtYWlkLmlubGluZS50c1xuICBjb2xvcjogdmFyKC0tZ3JheSk7XG4gIGJvcmRlci1jb2xvcjogdmFyKC0tZGFyayk7XG4gIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgYm9yZGVyOiAxcHggc29saWQ7XG4gIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgb3BhY2l0eTogMDtcbiAgdHJhbnNpdGlvbjogMC4ycztcblxuICAmID4gc3ZnIHtcbiAgICBmaWxsOiB2YXIoLS1saWdodCk7XG4gICAgZmlsdGVyOiBjb250cmFzdCgwLjMpO1xuICB9XG5cbiAgJjpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGJvcmRlci1jb2xvcjogdmFyKC0tc2Vjb25kYXJ5KTtcbiAgfVxuXG4gICY6Zm9jdXMge1xuICAgIG91dGxpbmU6IDA7XG4gIH1cbn1cblxucHJlIHtcbiAgJjpob3ZlciA+IC5leHBhbmQtYnV0dG9uIHtcbiAgICBvcGFjaXR5OiAxO1xuICAgIHRyYW5zaXRpb246IDAuMnM7XG4gIH1cbn1cblxuI21lcm1haWQtY29udGFpbmVyIHtcbiAgcG9zaXRpb246IGZpeGVkO1xuICBjb250YWluOiBsYXlvdXQ7XG4gIHotaW5kZXg6IDk5OTtcbiAgbGVmdDogMDtcbiAgdG9wOiAwO1xuICB3aWR0aDogMTAwdnc7XG4gIGhlaWdodDogMTAwdmg7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIGRpc3BsYXk6IG5vbmU7XG4gIGJhY2tkcm9wLWZpbHRlcjogYmx1cig0cHgpO1xuICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuNSk7XG5cbiAgJi5hY3RpdmUge1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgfVxuXG4gICYgPiAjbWVybWFpZC1zcGFjZSB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICB0b3A6IDUwJTtcbiAgICBsZWZ0OiA1MCU7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7XG4gICAgaGVpZ2h0OiA4MHZoO1xuICAgIHdpZHRoOiA4MHZ3O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgICAmID4gLm1lcm1haWQtY29udGVudCB7XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcyBlYXNlO1xuICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICBtaW4taGVpZ2h0OiAyMDBweDtcbiAgICAgIG1pbi13aWR0aDogMjAwcHg7XG5cbiAgICAgIHByZSB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgfVxuXG4gICAgICBzdmcge1xuICAgICAgICBtYXgtd2lkdGg6IG5vbmU7XG4gICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAmID4gLm1lcm1haWQtY29udHJvbHMge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAyMHB4O1xuICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZ2FwOiA4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgIHotaW5kZXg6IDI7XG5cbiAgICAgIC5tZXJtYWlkLWNvbnRyb2wtYnV0dG9uIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIHdpZHRoOiAzMnB4O1xuICAgICAgICBoZWlnaHQ6IDMycHg7XG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgY29sb3I6IHZhcigtLWRhcmspO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICBmb250LWZhbWlseTogdmFyKC0tYm9keUZvbnQpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuXG4gICAgICAgICY6aG92ZXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIH1cblxuICAgICAgICAmOmFjdGl2ZSB7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdHlsZSB0aGUgcmVzZXQgYnV0dG9uIGRpZmZlcmVudGx5XG4gICAgICAgICY6bnRoLWNoaWxkKDIpIHtcbiAgICAgICAgICB3aWR0aDogYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAwIDEycHg7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0= */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" data-persist="true"/><script src="../prescript.js" type="application/javascript" data-persist="true"></script><script type="application/javascript" data-persist="true">const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://mahesh-puri.github.io/full-stack-dev/index.xml"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image" content="https://mahesh-puri.github.io/full-stack-dev/Docker/5-Dockerfile-Mastery-og-image.webp"/><meta property="og:image:url" content="https://mahesh-puri.github.io/full-stack-dev/Docker/5-Dockerfile-Mastery-og-image.webp"/><meta name="twitter:image" content="https://mahesh-puri.github.io/full-stack-dev/Docker/5-Dockerfile-Mastery-og-image.webp"/><meta property="og:image:type" content="image/.webp"/></head><body data-slug="Docker/5-Dockerfile-Mastery"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="..">Quartz 4</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>Search</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-10" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../Docker/">Docker</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>5. Dockerfile Mastery</a></div></nav><h1 class="article-title">5. Dockerfile Mastery</h1><p show-comma="true" class="content-meta"><time datetime="2026-02-01T14:46:42.000Z">Feb 01, 2026</time><span>10 min read</span></p></div></div><article class="popover-hint"><p>A Dockerfile is not a shell script; it’s a <strong>deterministic build recipe</strong> that produces an immutable image. Once you understand how instructions translate into layers and how the cache behaves, you stop copy‑pasting random snippets and start designing Dockerfiles like you design code: intentionally, with tradeoffs in mind.</p>
<p>Below we walk through the mental model and every core instruction, then finish by refactoring a bad Dockerfile into a production‑quality one.</p>
<hr/>
<h2 id="1-mental-model-dockerfile-as-a-deterministic-build-recipe">1. Mental model: Dockerfile as a deterministic build recipe<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-mental-model-dockerfile-as-a-deterministic-build-recipe" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h2 id="topdown-execution-and-build-graph">Top‑down execution and build graph<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#topdown-execution-and-build-graph" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>When you run <code>docker build</code>:</p>
<ol>
<li>Docker sends the <strong>build context</strong> (files from your directory, minus <code>.dockerignore</code>) to the daemon.</li>
<li>It parses the Dockerfile <strong>top to bottom</strong>.</li>
<li>Each instruction (FROM, RUN, COPY, etc.) produces a <strong>new layer</strong> (except a few pure‑metadata ones like some LABELs).</li>
<li>The final image is a stack of these layers.</li>
</ol>
<p>You can think of it as:</p>
<ul>
<li><code>FROM</code> → base layers.</li>
<li>Every <code>RUN/COPY/ADD</code> → new layer on top.</li>
<li><code>CMD/ENTRYPOINT/ENV/EXPOSE/USER/WORKDIR/HEALTHCHECK</code> → configuration for how containers will run.</li>
</ul>
<h2 id="build-cache-and-layer-invalidation">Build cache and layer invalidation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#build-cache-and-layer-invalidation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Docker’s build cache works instruction by instruction:</p>
<ul>
<li>For each instruction, the daemon checks: “Have I already built this instruction before with the same inputs?”</li>
<li>Inputs include:
<ul>
<li>The instruction text itself.</li>
<li>The files it touches from the build context (e.g., paths in COPY).</li>
</ul>
</li>
<li>If identical, Docker <strong>reuses the old layer</strong> instead of re‑executing.</li>
</ul>
<p>If an instruction changes, or the files it touches change, that instruction and <strong>all instructions after it</strong> must be rebuilt.</p>
<p>That means:</p>
<ul>
<li>If you do <code>COPY . .</code> early, then any code change invalidates the cache for the rest of the file: expensive.</li>
<li>If you split dependency installation and source copy, you can reuse the dependency layer even when code changes.</li>
</ul>
<p>Example: better ordering for a Maven build:</p>
<pre><code># 1. Copy pom.xml only → stable if deps don’t change
COPY pom.xml .
RUN mvn -q -B dependency:go-offline

# 2. Copy source → changes more often
COPY src ./src
RUN mvn -q -B package -DskipTests

</code></pre>
<p>This is the core “art of small layers”: structure your Dockerfile so that <strong>rarely changing steps go first</strong>, frequently changing steps go later.</p>
<hr/>
<h2 id="2-core-instructions-with-intent">2. Core instructions, with intent<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-core-instructions-with-intent" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Let’s go instruction by instruction: what it really means and when to use it.</p>
<h2 id="21-from">2.1 FROM<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#21-from" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Sets the <strong>base image</strong> (starting point) for your build.</p>
<p>Examples:</p>
<pre><code>FROM eclipse-temurin:21-jre-alpine    # Java runtime
FROM node:22-alpine                   # Node.js
FROM python:3.13-slim                 # Python
</code></pre>
<p>When to use:</p>
<ul>
<li>Always at the top of each stage.</li>
<li>For multi‑stage builds, each new stage starts with <code>FROM</code>.</li>
</ul>
<p>Design considerations:</p>
<ul>
<li>Choose minimal but appropriate base (slim/alpine/distroless vs full OS).</li>
<li>Pin versions (<code>:21-jre-alpine</code>, not <code>:latest</code>) for reproducibility.</li>
<li>Prefer official or trusted vendor images.</li>
</ul>
<hr/>
<h2 id="22-run">2.2 RUN<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#22-run" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Executes a command <strong>at build time</strong> and commits the result as a new layer.</p>
<p>Examples:</p>
<pre><code>RUN apk add --no-cache curl

RUN apt-get update &amp;&amp; \
    apt-get install -y --no-install-recommends curl &amp;&amp; \
    rm -rf /var/lib/apt/lists/*
</code></pre>
<p>When to use:</p>
<ul>
<li>Install packages and dependencies.</li>
<li>Build/compile your application.</li>
<li>Perform one‑time setup that affects filesystem contents.</li>
</ul>
<p>Design tips:</p>
<ul>
<li>Combine related steps into a single <code>RUN</code> when they are tightly coupled, especially for package installation + cleanup.</li>
<li>Avoid leaving caches behind in earlier layers (do update/install/cleanup in the <strong>same</strong> RUN).</li>
<li>Don’t install heavy dev tools in the <strong>final</strong> runtime stage; keep them in build stages.</li>
</ul>
<hr/>
<h2 id="23-copy-and-add">2.3 COPY and ADD<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#23-copy-and-add" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Copy files/directories into the image.</p>
<ul>
<li>COPY:</li>
</ul>
<pre><code>COPY app.jar /app/app.jar
COPY src/ /app/src/
</code></pre>
<ul>
<li>ADD (with extra capabilities):</li>
</ul>
<pre><code>ADD data.tar.gz /data/        # auto‑extracts
ADD https://example.com/file /tmp/file   # fetches from URL
</code></pre>
<p>When to use:</p>
<ul>
<li><strong>COPY</strong> for almost everything: it’s explicit and predictable.</li>
<li><strong>ADD</strong> only when you <em>specifically need</em> its special behaviors (tar auto‑extract or URL fetch).</li>
</ul>
<p>We go deeper on COPY vs ADD in section 3.</p>
<hr/>
<h2 id="24-workdir">2.4 WORKDIR<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#24-workdir" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Sets the working directory for subsequent instructions.</p>
<pre><code>WORKDIR /app
COPY app.jar .
RUN ls -l
CMD [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]
</code></pre>
<p>When to use:</p>
<ul>
<li>To avoid full absolute paths everywhere.</li>
<li>To make your Dockerfile cleaner and commands shorter.</li>
</ul>
<p>Notes:</p>
<ul>
<li>If the directory doesn’t exist, Docker creates it.</li>
<li>You can set WORKDIR multiple times; each new one becomes the current working directory for the following instructions.</li>
</ul>
<hr/>
<h2 id="25-env">2.5 ENV<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#25-env" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Sets environment variables that will be available <strong>at build time and runtime</strong>.</p>
<pre><code>ENV SPRING_PROFILES_ACTIVE=prod
ENV JAVA_OPTS=&quot;-Xms256m -Xmx512m&quot;
</code></pre>
<p>When to use:</p>
<ul>
<li>To bake <strong>default</strong> runtime configuration into the image.</li>
<li>To set environment variables needed during build (though <code>ARG</code> is often more appropriate for build‑only values).</li>
</ul>
<p>Containers can override ENV at runtime:</p>
<p>bash</p>
<p><code>docker run -e SPRING_PROFILES_ACTIVE=stage myorg/app:1.0.0</code></p>
<hr/>
<h2 id="26-arg">2.6 ARG<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#26-arg" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Defines build‑time variables available only <strong>during build</strong>.</p>
<pre><code>ARG BUILD_VERSION=dev
ARG GIT_SHA

RUN echo &quot;Building version $BUILD_VERSION from $GIT_SHA&quot;
LABEL version=&quot;$BUILD_VERSION&quot; git_sha=&quot;$GIT_SHA&quot;
</code></pre>
<p>When to use:</p>
<ul>
<li>To pass build metadata (versions, git SHA, build date).</li>
<li>To toggle build behavior (e.g., <code>ARG ENABLE_DEBUG_TOOLS=true</code> used only in build stage).</li>
</ul>
<p>They do <strong>not</strong> exist in the resulting container environment unless you explicitly copy them into ENV or labels.</p>
<p>Build with:</p>
<pre><code>docker build \
  --build-arg BUILD_VERSION=1.2.3 \
  --build-arg GIT_SHA=abc1234 \
  -t myorg/app:1.2.3 .
</code></pre>
<p>We explore ENV vs ARG patterns in section 4.</p>
<hr/>
<h2 id="27-expose">2.7 EXPOSE<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#27-expose" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Documents which ports the container listens on.</p>
<pre><code>EXPOSE 8080
EXPOSE 8080 8443
</code></pre>
<p>When to use:</p>
<ul>
<li>As a form of documentation and metadata for tools.</li>
<li>So <code>docker run -P</code> knows which ports to auto‑publish.</li>
</ul>
<p>Important:</p>
<ul>
<li>EXPOSE does <strong>not</strong> actually open ports on the host; you still need <code>-p</code> in <code>docker run</code>.</li>
</ul>
<hr/>
<h2 id="28-user">2.8 USER<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#28-user" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Sets which user the following instructions (and the default container process) will run as.</p>
<pre><code>RUN addgroup -S app &amp;&amp; adduser -S app -G app
USER app
</code></pre>
<p>When to use:</p>
<ul>
<li>To drop root privileges and run your app as a non‑root user.</li>
<li>As part of basic container hardening.</li>
</ul>
<p>Once you set USER, subsequent RUN instructions also run under that user unless you switch back.</p>
<p>We discuss security patterns more in section 6.</p>
<hr/>
<h2 id="29-cmd">2.9 CMD<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#29-cmd" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Defines the <strong>default command</strong> (and/or arguments) to run when a container starts.</p>
<p>Exec form (recommended):</p>
<p><code>CMD [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]</code></p>
<p>Shell form:</p>
<p><code>CMD java -jar app.jar</code></p>
<p>When to use:</p>
<ul>
<li>To set the default command or default arguments for your container.</li>
<li>Expecting that users (or orchestrators) may override it at <code>docker run</code> time.</li>
</ul>
<p>CMD is often combined with ENTRYPOINT (see section 5).</p>
<hr/>
<h2 id="210-entrypoint">2.10 ENTRYPOINT<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#210-entrypoint" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Defines the <strong>fixed executable</strong> that will always be run for this container.</p>
<p><code>ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]</code></p>
<p>When to use:</p>
<ul>
<li>When your container is fundamentally “this binary”.</li>
<li>To make sure the main process is always your app, and CLI args are treated as arguments to it.</li>
</ul>
<p>Together with CMD, it becomes:</p>
<pre><code>ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]
CMD [&quot;--spring.profiles.active=prod&quot;]
</code></pre>
<p>At runtime, Docker effectively runs:</p>
<p><code>java -jar app.jar --spring.profiles.active=prod</code></p>
<p>We detail CMD vs ENTRYPOINT in section 5.</p>
<hr/>
<h2 id="211-healthcheck">2.11 HEALTHCHECK<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#211-healthcheck" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Defines a command Docker runs periodically to verify container health.</p>
<pre><code>HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1
</code></pre>
<p>When to use:</p>
<ul>
<li>When you want a signal beyond “process is running.”</li>
<li>To help orchestrators avoid routing traffic to unhealthy containers.</li>
</ul>
<p>Good healthchecks are <strong>cheap</strong> and <strong>local</strong>; they shouldn’t depend heavily on external systems unless that’s part of your SLA.</p>
<hr/>
<h2 id="3-copy-vs-add--the-subtle-traps">3. COPY vs ADD – the subtle traps<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-copy-vs-add--the-subtle-traps" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>You almost always want <code>COPY</code>. The reason is simple: <code>ADD</code> does more than just copy, and that extra behavior can surprise you.</p>
<h2 id="what-add-does-in-addition">What ADD does in addition<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#what-add-does-in-addition" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>If the source is a tar archive and the destination is a directory, ADD <strong>auto‑extracts</strong> it.</li>
<li>If the source is a URL, ADD fetches it over HTTP/HTTPS.</li>
</ul>
<p>Example:</p>
<p><code>ADD data.tar.gz /data/   # /data contains extracted contents</code></p>
<p>This may look convenient, but:</p>
<ul>
<li>It hides logic: you can’t tell from the Dockerfile alone that extraction is happening.</li>
<li>You have less control over where and how it extracts.</li>
<li>Using URLs in ADD can complicate caching and reproducibility (network changes vs build cache).</li>
</ul>
<h2 id="why-copy-is-preferred">Why COPY is preferred<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#why-copy-is-preferred" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>COPY is dumb and predictable: “copy exactly these files to exactly there.”</li>
<li>It interacts clearly with <code>.dockerignore</code>.</li>
<li>You can handle downloads and extractions explicitly in a RUN, where you also control cleanup.</li>
</ul>
<p>Example with RUN instead of ADD URL:</p>
<pre><code>RUN curl -L https://example.com/file.tar.gz -o /tmp/file.tar.gz &amp;&amp; \
    tar xzf /tmp/file.tar.gz -C /data &amp;&amp; \
    rm /tmp/file.tar.gz
</code></pre>
<p>You control:</p>
<ul>
<li>Where the file goes.</li>
<li>How it’s extracted.</li>
<li>That temporary artifact is cleaned up in the same layer.</li>
</ul>
<p><strong>Rule of thumb:</strong> default to COPY; reach for ADD only when you truly want its special behaviors and understand the tradeoffs.</p>
<hr/>
<h2 id="4-env-and-arg-patterns">4. ENV and ARG patterns<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-env-and-arg-patterns" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h2 id="buildtime-vs-runtime-configuration">Build‑time vs runtime configuration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#buildtime-vs-runtime-configuration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li><strong>ARG</strong>: build‑time only, not available in running containers unless explicitly propagated.</li>
<li><strong>ENV</strong>: runtime environment variables baked into the image (and also available during build after they’re set).</li>
</ul>
<p>Pattern: pass build metadata via ARG, then store it via LABEL or ENV if needed at runtime.</p>
<p>Example:</p>
<pre><code>ARG BUILD_VERSION=dev
ARG GIT_SHA=unknown

LABEL version=&quot;$BUILD_VERSION&quot; git_sha=&quot;$GIT_SHA&quot;

ENV APP_VERSION=$BUILD_VERSION
</code></pre>
<p>Build:</p>
<pre><code>docker build \
  --build-arg BUILD_VERSION=1.2.3 \
  --build-arg GIT_SHA=abc1234 \
  -t myorg/app:1.2.3 .
</code></pre>
<p>Now:</p>
<ul>
<li>The image has labels with version and SHA.</li>
<li>The container has <code>APP_VERSION</code> at runtime.</li>
</ul>
<h2 id="runtime-profiles-with-env--override">Runtime profiles with ENV + override<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#runtime-profiles-with-env--override" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>For a Spring Boot app:</p>
<p>text</p>
<p><code>ENV SPRING_PROFILES_ACTIVE=prod</code></p>
<p>You can override per environment:</p>
<pre><code># Staging
docker run -e SPRING_PROFILES_ACTIVE=stage myorg/app:1.2.3

# Dev
docker run -e SPRING_PROFILES_ACTIVE=dev myorg/app:1.2.3
</code></pre>
<p>Design principle:</p>
<ul>
<li>Don’t rebuild images just to change environment‑specific settings.</li>
<li>Use ENV for defaults; override via runtime env variables in Compose/Kubernetes.</li>
</ul>
<hr/>
<h2 id="5-cmd-vs-entrypoint-patterns">5. CMD vs ENTRYPOINT patterns<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-cmd-vs-entrypoint-patterns" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h2 id="fixed-executable-vs-overridable-parameters">Fixed executable vs overridable parameters<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#fixed-executable-vs-overridable-parameters" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Think of:</p>
<ul>
<li><strong>ENTRYPOINT</strong> = binary to always run.</li>
<li><strong>CMD</strong> = default arguments, overridable at runtime.</li>
</ul>
<p>Canonical pattern:</p>
<pre><code>ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]
CMD [&quot;--spring.profiles.active=prod&quot;]
</code></pre>
<p>Then:</p>
<pre><code># uses default profile=prod
docker run myorg/app:1.0.0

# override profile with CLI arg
docker run myorg/app:1.0.0 --spring.profiles.active=stage

</code></pre>
<p>Docker effectively does:
<code>java -jar app.jar --spring.profiles.active=stage</code></p>
<h2 id="common-mistakes">Common mistakes<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#common-mistakes" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>Putting everything in CMD and then overriding the whole thing at runtime:</p>
<p><code>CMD [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;,&quot;--spring.profiles.active=prod&quot;]</code></p>
<p>If someone runs <code>docker run myorg/app:1.0.0 my-custom-command</code>, your app doesn’t run at all.</p>
</li>
<li>
<p>Using shell form and breaking signal handling:</p>
<p><code>CMD java -jar app.jar</code></p>
<p>PID 1 is <code>/bin/sh -c</code>, not your app; SIGTERM/SIGINT may not propagate cleanly.</p>
</li>
</ol>
<p><strong>Better:</strong> use exec form for both ENTRYPOINT and CMD.</p>
<hr/>
<h2 id="6-securityaware-dockerfile-writing">6. Security‑aware Dockerfile writing<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-securityaware-dockerfile-writing" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The Dockerfile is your first line of defense. A few simple patterns dramatically reduce risk.</p>
<h2 id="61-nonroot-user">6.1 Non‑root user<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#61-nonroot-user" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Create a dedicated user and drop root:</p>
<pre><code>FROM eclipse-temurin:21-jre-alpine

RUN addgroup -S app &amp;&amp; adduser -S app -G app

WORKDIR /app
COPY app.jar /app/app.jar

USER app

CMD [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]
</code></pre>
<p>Benefits:</p>
<ul>
<li>Even if your app is compromised, the attacker has fewer privileges in the container.</li>
<li>Limits damage from misconfigurations.</li>
</ul>
<p>Remember to ensure directories your app writes to are writable by <code>app</code>.</p>
<h2 id="62-no-secrets-in-images">6.2 No secrets in images<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#62-no-secrets-in-images" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Never:</p>
<ul>
<li><code>COPY .env /app/.env</code></li>
<li><code>ENV DB_PASSWORD=supersecret</code> in a public or widely shared image.</li>
</ul>
<p>Better:</p>
<ul>
<li>Inject secrets at runtime via environment variables, secret managers, or orchestrator mechanisms (Kubernetes Secrets, etc.).</li>
<li>Restrict secrets to runtime configuration, not immutable image configuration.</li>
</ul>
<h2 id="63-minimal-surface-area">6.3 Minimal surface area<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#63-minimal-surface-area" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>Use minimal base images (alpine, slim, distroless).</li>
<li>Avoid unnecessary tools (curl, ping, etc.) in the <strong>final</strong> runtime image; keep them only in build or debug images.</li>
</ul>
<p>The smaller and simpler your image, the fewer attack vectors and CVEs you’ll carry.</p>
<hr/>
<h2 id="7-example-refactoring-a-bad-dockerfile">7. Example: refactoring a bad Dockerfile<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#7-example-refactoring-a-bad-dockerfile" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h2 id="71-naïve-dockerfile">7.1 Naïve Dockerfile<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#71-naïve-dockerfile" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<pre><code>FROM openjdk:21

WORKDIR /app
COPY . .
RUN mvn package
CMD [&quot;java&quot;,&quot;-jar&quot;,&quot;target/app.jar&quot;]
</code></pre>
<p>Issues:</p>
<ul>
<li>Heavy base image (full OS + JDK).</li>
<li>Copies entire context (including <code>.git</code>, <code>target</code>, docs, etc.).</li>
<li>Poor cache usage: any code change invalidates Maven dependency downloads.</li>
<li>Runs as root.</li>
<li>No explicit healthcheck or environment defaults.</li>
<li>Build tools (Maven, JDK) are in the same image used in production.</li>
</ul>
<h2 id="72-refactored-productiongrade-dockerfile">7.2 Refactored, production‑grade Dockerfile<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#72-refactored-productiongrade-dockerfile" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<pre><code># Stage 1: build
FROM eclipse-temurin:21-jdk-alpine AS build
WORKDIR /app

# Install dependencies based on pom.xml (good cache usage)
COPY pom.xml .
RUN mvn -q -B dependency:go-offline

# Copy source and build
COPY src ./src
RUN mvn -q -B package -DskipTests

# Stage 2: runtime
FROM eclipse-temurin:21-jre-alpine

# Create non-root user
RUN addgroup -S app &amp;&amp; adduser -S app -G app

WORKDIR /app
COPY --from=build /app/target/app.jar app.jar

# Runtime defaults
ENV SPRING_PROFILES_ACTIVE=prod

USER app
EXPOSE 8080

# Healthcheck (simple example)
HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

# Binary + default args pattern
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]
CMD [&quot;--spring.profiles.active=prod&quot;]
</code></pre>
<p>What improved:</p>
<ul>
<li><strong>Multi‑stage build</strong>: JDK + Maven only in build stage; final image has JRE only.</li>
<li>Smaller, more secure runtime image.</li>
<li>Better <strong>cache behavior</strong>: dependencies cached separately from source.</li>
<li>Non‑root user.</li>
<li>EXPOSE and HEALTHCHECK provide standard metadata and health signal.</li>
<li>ENTRYPOINT/CMD split allows overriding profile without rewriting command.</li>
</ul>
<p>This is “Dockerfile mastery”: the same basic goal (run a Spring Boot JAR) implemented in a way that respects performance, security, maintainability, and observability.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-8" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#1-mental-model-dockerfile-as-a-deterministic-build-recipe" data-for="1-mental-model-dockerfile-as-a-deterministic-build-recipe">1. Mental model: Dockerfile as a deterministic build recipe</a></li><li class="depth-0"><a href="#topdown-execution-and-build-graph" data-for="topdown-execution-and-build-graph">Top‑down execution and build graph</a></li><li class="depth-0"><a href="#build-cache-and-layer-invalidation" data-for="build-cache-and-layer-invalidation">Build cache and layer invalidation</a></li><li class="depth-0"><a href="#2-core-instructions-with-intent" data-for="2-core-instructions-with-intent">2. Core instructions, with intent</a></li><li class="depth-0"><a href="#21-from" data-for="21-from">2.1 FROM</a></li><li class="depth-0"><a href="#22-run" data-for="22-run">2.2 RUN</a></li><li class="depth-0"><a href="#23-copy-and-add" data-for="23-copy-and-add">2.3 COPY and ADD</a></li><li class="depth-0"><a href="#24-workdir" data-for="24-workdir">2.4 WORKDIR</a></li><li class="depth-0"><a href="#25-env" data-for="25-env">2.5 ENV</a></li><li class="depth-0"><a href="#26-arg" data-for="26-arg">2.6 ARG</a></li><li class="depth-0"><a href="#27-expose" data-for="27-expose">2.7 EXPOSE</a></li><li class="depth-0"><a href="#28-user" data-for="28-user">2.8 USER</a></li><li class="depth-0"><a href="#29-cmd" data-for="29-cmd">2.9 CMD</a></li><li class="depth-0"><a href="#210-entrypoint" data-for="210-entrypoint">2.10 ENTRYPOINT</a></li><li class="depth-0"><a href="#211-healthcheck" data-for="211-healthcheck">2.11 HEALTHCHECK</a></li><li class="depth-0"><a href="#3-copy-vs-add--the-subtle-traps" data-for="3-copy-vs-add--the-subtle-traps">3. COPY vs ADD – the subtle traps</a></li><li class="depth-0"><a href="#what-add-does-in-addition" data-for="what-add-does-in-addition">What ADD does in addition</a></li><li class="depth-0"><a href="#why-copy-is-preferred" data-for="why-copy-is-preferred">Why COPY is preferred</a></li><li class="depth-0"><a href="#4-env-and-arg-patterns" data-for="4-env-and-arg-patterns">4. ENV and ARG patterns</a></li><li class="depth-0"><a href="#buildtime-vs-runtime-configuration" data-for="buildtime-vs-runtime-configuration">Build‑time vs runtime configuration</a></li><li class="depth-0"><a href="#runtime-profiles-with-env--override" data-for="runtime-profiles-with-env--override">Runtime profiles with ENV + override</a></li><li class="depth-0"><a href="#5-cmd-vs-entrypoint-patterns" data-for="5-cmd-vs-entrypoint-patterns">5. CMD vs ENTRYPOINT patterns</a></li><li class="depth-0"><a href="#fixed-executable-vs-overridable-parameters" data-for="fixed-executable-vs-overridable-parameters">Fixed executable vs overridable parameters</a></li><li class="depth-0"><a href="#common-mistakes" data-for="common-mistakes">Common mistakes</a></li><li class="depth-0"><a href="#6-securityaware-dockerfile-writing" data-for="6-securityaware-dockerfile-writing">6. Security‑aware Dockerfile writing</a></li><li class="depth-0"><a href="#61-nonroot-user" data-for="61-nonroot-user">6.1 Non‑root user</a></li><li class="depth-0"><a href="#62-no-secrets-in-images" data-for="62-no-secrets-in-images">6.2 No secrets in images</a></li><li class="depth-0"><a href="#63-minimal-surface-area" data-for="63-minimal-surface-area">6.3 Minimal surface area</a></li><li class="depth-0"><a href="#7-example-refactoring-a-bad-dockerfile" data-for="7-example-refactoring-a-bad-dockerfile">7. Example: refactoring a bad Dockerfile</a></li><li class="depth-0"><a href="#71-naïve-dockerfile" data-for="71-naïve-dockerfile">7.1 Naïve Dockerfile</a></li><li class="depth-0"><a href="#72-refactored-productiongrade-dockerfile" data-for="72-refactored-productiongrade-dockerfile">7.2 Refactored, production‑grade Dockerfile</a></li><li class="overflow-end"></li></ul></div><div class="backlinks"><h3>Backlinks</h3><ul id="list-2" class="overflow"><li><a href="../Docker/0-Course-Overview-and-Index" class="internal">0. Course Overview and Index</a></li><li><a href="../" class="internal">Docker Mastery</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.2</a> © 2026</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript" data-persist="true">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module" data-persist="true">function E(a,e){if(!a)return;function t(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function n(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}a?.addEventListener("click",t),window.addCleanup(()=>a?.removeEventListener("click",t)),document.addEventListener("keydown",n),window.addCleanup(()=>document.removeEventListener("keydown",n))}function f(a){for(;a.firstChild;)a.removeChild(a.firstChild)}var m=class{constructor(e,t){this.container=e;this.content=t;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),t=this.onMouseMove.bind(this),n=this.onMouseUp.bind(this),o=this.onTouchStart.bind(this),r=this.onTouchMove.bind(this),i=this.onTouchEnd.bind(this),s=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",t),document.addEventListener("mouseup",n),this.container.addEventListener("touchstart",o,{passive:!1}),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("touchend",i),window.addEventListener("resize",s),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",t),()=>document.removeEventListener("mouseup",n),()=>this.container.removeEventListener("touchstart",o),()=>document.removeEventListener("touchmove",r),()=>document.removeEventListener("touchend",i),()=>window.removeEventListener("resize",s))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let t=this.createButton("+",()=>this.zoom(.1)),n=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(n),e.appendChild(o),e.appendChild(t),this.container.appendChild(e)}createButton(e,t){let n=document.createElement("button");return n.textContent=e,n.className="mermaid-control-button",n.addEventListener("click",t),window.addCleanup(()=>n.removeEventListener("click",t)),n}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}onTouchStart(e){if(e.touches.length!==1)return;this.isDragging=!0;let t=e.touches[0];this.startPan={x:t.clientX-this.currentPan.x,y:t.clientY-this.currentPan.y}}onTouchMove(e){if(!this.isDragging||e.touches.length!==1)return;e.preventDefault();let t=e.touches[0];this.currentPan={x:t.clientX-this.startPan.x,y:t.clientY-this.startPan.y},this.updateTransform()}onTouchEnd(){this.isDragging=!1}zoom(e){let t=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),n=this.content.getBoundingClientRect(),o=n.width/2,r=n.height/2,i=t-this.scale;this.currentPan.x-=o*i,this.currentPan.y-=r*i,this.scale=t,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){let t=this.content.querySelector("svg").getBoundingClientRect(),n=t.width/this.scale,o=t.height/this.scale;this.scale=1,this.currentPan={x:(this.container.clientWidth-n)/2,y:(this.container.clientHeight-o)/2},this.updateTransform()}},T=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],y;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;y||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let t=y.default,n=new WeakMap;for(let r of e)n.set(r,r.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let c=n.get(s);c&&(s.innerHTML=c)}let r=T.reduce((s,c)=>(s[c]=window.getComputedStyle(document.documentElement).getPropertyValue(c),s),{}),i=document.documentElement.getAttribute("saved-theme")==="dark";t.initialize({startOnLoad:!1,securityLevel:"loose",theme:i?"dark":"base",themeVariables:{fontFamily:r["--codeFont"],primaryColor:r["--light"],primaryTextColor:r["--darkgray"],primaryBorderColor:r["--tertiary"],lineColor:r["--darkgray"],secondaryColor:r["--secondary"],tertiaryColor:r["--tertiary"],clusterBkg:r["--light"],edgeLabelBackground:r["--highlight"]}}),await t.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let r=0;r<e.length;r++){let v=function(){let g=l.querySelector("#mermaid-space"),h=l.querySelector(".mermaid-content");if(!h)return;f(h);let w=i.querySelector("svg").cloneNode(!0);h.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new m(g,h)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},i=e[r],s=i.parentElement,c=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(c),L=c.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),E(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript" data-persist="true"></script><script src="../postscript.js" type="module" data-persist="true"></script></html>